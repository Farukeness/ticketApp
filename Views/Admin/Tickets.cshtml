@model TicketListViewModel
@{
    Layout = "~/Views/Shared/_adminLayout.cshtml";
}


@(Html.Kendo().Grid<ticketApp.Models.Tickets>().Name("AdminTickets")
    .Columns(columns => {
        columns.Bound(c => c.Title);
        columns.Bound(c => c.Description);
        columns.Bound(c => c.ticketType).Filterable(f => f.Multi(true).Search(true));
        columns.Bound(c => c.ticketPriority).Filterable(f => f.Multi(true).Search(true));
        columns.Bound(c => c.ticketStatus)
        .ClientTemplate("<span id='badge_#=ticketStatus#' class='badgeTemplate' ></span>");
        columns.Bound(c => c.CreatedAt).Format("{0:dd//MM/yyyy HH:mm}");
        columns.Command(command => { command.Edit(); }).Width(200);
        columns.Template("<button type='button' class='btn btn-primary' onclick='openModal(#=Id#)'>Geliştirici Ata</button>").Title("Geliştirici").HtmlAttributes(new {style ="color:white"});
    })
    .Editable(editable => editable.Mode(GridEditMode.InLine))
    .Pageable()
    .Sortable()
    .Navigatable()
    .Filterable()
    .Scrollable()
    .Events(events => events.DataBound("onDataBound"))
    .DataSource(dataSource => dataSource
    .Ajax()
    .Model(model => {
        model.Id(p => p.Id);
        model.Field(p => p.CreatedAt).Editable(false);
        model.Field(p => p.ticketStatus).Editable(false);
    })
    .Update(update => update.Action("EditAdminInline", "Grid"))
    .Read(read => read.Action("Tickets_All","Grid"))
    .Sort(s => s.Add(p => p.CreatedAt).Descending())
    ))



<div class="modal fade "  tabindex="-1" id="myModal" aria-hidden="true" data-bs-backdrop="static" >
    <div class="modal-dialog modal-dialog-scrollable">
        <form asp-action="EditAssigned"  method="post">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" >Geliştiriciler</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Kapat"></button>
            </div>
            <div class="modal-body">
                <input type="hidden" id="ticketId" name="Id" value="">
                <div id="developersList">
                    
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-dark" data-bs-dismiss="modal" >İptal</button>
                <button type="submit" class="btn btn-success" data-bs-dismiss="modal" >Onayla</button>
                
            </div>
            </form>
        </div>
    </div>
</div>

<style>
.k-badge {
    font-size: 14px !important;
    padding: 6px 12px !important;
    font-weight: 500 !important;
}

.large-badge {
    font-size: 16px !important;
    padding: 8px 16px !important;
    font-weight: 600 !important;
}
</style>

<script>
function openModal(ticketId) {
    document.getElementById('ticketId').value = ticketId;
    var modal = new bootstrap.Modal(document.getElementById('myModal'));
    modal.show();
    loadDevelopers(ticketId);
}

function loadDevelopers(ticketId) {
    fetch('/Admin/TicketEdit/' + ticketId)
    .then(response => response.json())
    .then(data => {
        if (data.success) {
            var developersList = document.getElementById('developersList');
            developersList.innerHTML = '';
            
            data.developers.forEach(function(developer) {
                var checkbox = document.createElement('input');
                checkbox.type = 'checkbox';
                checkbox.name = 'AssignedToUsers';
                checkbox.value = developer.id;
                checkbox.id = 'AssignedToUsers_' + developer.id;
                if (developer.isAssigned) {
                    checkbox.checked = true;
                }
                
                var label = document.createElement('label');
                label.htmlFor = 'AssignedToUsers_' + developer.id;
                label.textContent = developer.userName;
                label.style.marginLeft = '10px';
                
                var br = document.createElement('br');
                
                developersList.appendChild(checkbox);
                developersList.appendChild(label);
                developersList.appendChild(br);
            });
        } else {
            console.error('Geliştiriciler yüklenemedi:', data.message);
        }
    })
    .catch(error => {
        console.error('Geliştiriciler yüklenirken hata:', error);
    });
}

function onDataBound(e) {
        var grid = this;
        grid.table.find("tr").each(function () {
            var dataItem = grid.dataItem(this);
            var themeColor = dataItem.ticketStatus ? 'error' : 'success';
            var text = dataItem.ticketStatus ? 'Kapalı' : 'Açık';

            $(this).find('script').each(function () {
                eval($(this).html());
            });

                    $(this).find(".badgeTemplate").kendoBadge({
            themeColor: themeColor,
            text: text,
            cssClass: "large-badge"
        });


            kendo.bind($(this), dataItem);
        });
    }
</script>