@model TicketDetailViewModel
@{
    Layout = "~/Views/Shared/_developerLayout.cshtml";
}
<h2>Bilet Detayı</h2>

<div class="card mb-4">
    <div class="card-header">
        <strong>@Model.ticket.Title</strong>
    </div>
    <div class="card-body">
        <p><strong>Açıklama:</strong> @Model.ticket.Description</p>
        <p><strong>Tür:</strong> @Model.ticket.ticketType</p>
        <p><strong>Öncelik:</strong> @Model.ticket.ticketPriority</p>
        <p><strong>Durum:@Model.ticket.ticketStatus</strong></p>
        <p><strong>Oluşturulma Tarihi:</strong> @Model.ticket.CreatedAt.ToString("dd.MM.yyyy HH:mm")</p>
        <form asp-action="Detail" method="post">
            <select name="ticketStatus" id="ticketStatus">
                <option value="" disabled selected>Durum:@Model.ticket.ticketStatus</option>
                @foreach(var opt in Enum.GetValues(typeof(TicketStatus)))
                {
                    <option value="@opt">@opt</option>
                }
            </select>
            <input type="hidden" name="Id" value="@Model.ticket.Id" />
            <button type="submit" class="btn btn-primary btn-sm">Güncelle</button>
        </form>
    </div>
</div>

<h4>Yorumlar</h4>
@if (Model.ticketComment.Any())
{
    <ul class="list-group mb-4">
        @foreach (var comment in Model.ticketComment)
        {
            <li class="list-group-item">
                <strong>@comment.AppUser</strong> - @comment.CommentedAt.ToString("dd.MM.yyyy HH:mm")<br />
                @comment.CommentText
                @foreach(var user in Model.Usernames)
                {
                    @if(comment.CommentedByUserId == user.Id)
                    {
                        <p>@user.UserName</p>
                        
                    }
                }
            </li>
        }
    </ul>
}
else
{
    <p class="text-muted">Henüz yorum yok.</p>
}

<form asp-action="AddComment" method="post" class="mb-4">
    <input type="hidden" name="ticketId" value="@Model.ticket.Id" />
    <div class="mb-2">
        <textarea name="comment" class="form-control" placeholder="Yorumunuzu yazın..." required></textarea>
    </div>
    <button type="submit" class="btn btn-secondary btn-sm">Yorum Ekle</button>
</form>

<h4>Ekli Dosyalar</h4>
@if (Model.ticketAttachments.Any())
{
    <ul class="list-group mb-4">
        @foreach (var file in Model.ticketAttachments)
        {
            <li class="list-group-item">
                @if(file.ContentType.StartsWith("image"))
                {
                    <img style="width: 300px;" src="~/uploads/@file.FileName" />
                }
                <br>
                <a  asp-action="Download" asp-controller="Files" asp-route-id="@file.Id">@file.FileName</a>
            </li>
        }
    </ul>
}
else
{
    <p class="text-muted">Dosya eklenmemiş.</p>
}

